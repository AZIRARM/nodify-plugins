{
  "id": "540d48a5-65dc-4c41-9a68-4a31befd99f1",
  "enabled": true,
  "editable": false,
  "description": "Nodify plugin for content comments only html/js content",
  "name": "comments",
  "code": "/**\n * Injects a basic comment UI inside a target container\n * @param {string} CONTAINER_ID - ID of the container where the comment UI will be injected\n * @param {string} CONTENT_CODE - Unique code of the content\n * @param {string} DATA_NAME - Data name (e.g. \"COMMENTS\")\n * @param {string} API_URL - Base API URL (without trailing slash)\n * @param {string} PLACE_HOLDER_MESSAGE - Placeholder text for the textarea\n * @param {string} BUTTON_NAME - Label for the submit button\n * @param {string} SEARCH_MESSAGE - Message displayed while loading comments\n * @param {string} NO_COMMENTS_MESSAGE - Message displayed when no comments exist\n * @param {string} USER - Current user's name\n */\nfunction initComments(CONTAINER_ID, CONTENT_CODE, DATA_NAME, API_URL, PLACE_HOLDER_MESSAGE, BUTTON_NAME, SEARCH_MESSAGE, NO_COMMENTS_MESSAGE, USER) {\n  const container = document.getElementById(CONTAINER_ID);\n  if (!container) {\n    console.warn(`No element found with ID: ${CONTAINER_ID}`);\n    return;\n  }\n\n  const commentId = `comment-${CONTENT_CODE}-${DATA_NAME}`;\n  container.innerHTML = `\n    <div class=\"comment-container\">\n      <div class=\"comment-list\" id=\"${commentId}-list\">\n        <p>${SEARCH_MESSAGE}</p>\n      </div>\n      <form class=\"comment-form\" id=\"${commentId}-form\">\n        <textarea placeholder=\"${PLACE_HOLDER_MESSAGE}\" id=\"${commentId}-textarea\" disabled></textarea>\n        <div class=\"submit-wrapper\">\n          <button type=\"submit\" id=\"${commentId}-submit\" disabled>${BUTTON_NAME}</button>\n        </div>\n      </form>\n    </div>\n  `;\n\n  // Fetch existing comments\n  fetch(`${API_URL}/datas/contents/${CONTENT_CODE}/name/${DATA_NAME}`)\n    .then(res => {\n      if (!res.ok) throw new Error(`Failed to load comments (${res.status})`);\n      return res.json();\n    })\n    .then(comments => {\n      const listEl = document.getElementById(`${commentId}-list`);\n      listEl.innerHTML = '';\n\n      if (Array.isArray(comments) && comments.length > 0) {\n        comments.forEach(comment => {\n          const div = document.createElement('div');\n          div.className = 'comment-item';\n          \n          const user = comment.user || \"ðŸ‘½\";\n          const date = comment.creationDate ? new Date(comment.creationDate).toLocaleString() : \"ðŸ“†\";\n\n          div.innerHTML = `\n            <div class=\"comment-meta\"><strong>${user}</strong> <span class=\"comment-date\">${date}</span></div>\n            <div class=\"comment-text\">${comment.value}</div>\n          `;\n          listEl.appendChild(div);\n        });\n      } else {\n        listEl.innerHTML = `<p>${NO_COMMENTS_MESSAGE}</p>`;\n      }\n\n      // Enable form\n      document.getElementById(`${commentId}-textarea`).disabled = false;\n      document.getElementById(`${commentId}-submit`).disabled = false;\n    })\n    .catch(err => {\n      console.error(\"Error loading comments:\", err);\n    });\n\n  // Handle comment submission\n  document.addEventListener('submit', function (e) {\n    if (e.target && e.target.id === `${commentId}-form`) {\n      e.preventDefault();\n\n      const textarea = document.getElementById(`${commentId}-textarea`);\n      const value = textarea.value.trim();\n      if (!value) return;\n\n      fetch(`${API_URL}/datas`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          contentNodeCode: CONTENT_CODE,\n          dataType: \"text\",\n          name: DATA_NAME,\n          key: Math.random().toString(36).slice(2),\n          value,\n          user: USER\n        })\n      })\n        .then(res => {\n          if (!res.ok) throw new Error(`Failed to post comment (${res.status})`);\n          return res.json();\n        })\n        .then(() => {\n          const listEl = document.getElementById(`${commentId}-list`);\n          const div = document.createElement('div');\n          div.className = 'comment-item';\n\n          const now = new Date().toLocaleString();\n          div.innerHTML = `\n            <div class=\"comment-meta\"><strong>${USER}</strong> <span class=\"comment-date\">${now}</span></div>\n            <div class=\"comment-text\">${value}</div>\n          `;\n          listEl.appendChild(div);\n\n          textarea.value = '';\n        })\n        .catch(err => {\n          console.error(\"Error posting comment:\", err);\n        });\n    }\n  });\n}\n",
  "entrypoint": null,
  "creationDate": 1749383757505,
  "modificationDate": 1749414799669,
  "modifiedBy": null,
  "deleted": false,
  "resources": []
}